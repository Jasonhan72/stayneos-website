(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4907],{9068:function(e,t,n){Promise.resolve().then(n.bind(n,5279))},2660:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6858:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},1047:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},401:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},875:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},2451:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},407:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},9322:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},1671:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},9388:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},9202:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},4938:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]])},3245:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},1817:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9554:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},9397:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7168:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},3247:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},6865:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},5805:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},5395:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},2489:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});let r=(0,n(8755).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5279:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var r=n(7437),a=n(2265),l=n(7648),s=n(6334),i=n(6741),c=n(1427),o=n(1047),u=n(4938),d=n(401),h=n(2489),m=n(1817),f=n(6858),x=n(407),p=n(3448);let g=[{id:"upcoming",label:"Upcoming"},{id:"current",label:"Current"},{id:"past",label:"Past"},{id:"cancelled",label:"Cancelled"}],y={PENDING:{label:"Pending",color:"text-yellow-700",bgColor:"bg-yellow-100"},CONFIRMED:{label:"Confirmed",color:"text-green-700",bgColor:"bg-green-100"},CHECKED_IN:{label:"Checked in",color:"text-blue-700",bgColor:"bg-blue-100"},CHECKED_OUT:{label:"Checked out",color:"text-gray-700",bgColor:"bg-gray-100"},CANCELLED:{label:"Cancelled",color:"text-red-700",bgColor:"bg-red-100"}};function b(){let{user:e,isAuthenticated:t}=(0,c.aC)(),[n,b]=(0,a.useState)("upcoming"),[k,v]=(0,a.useState)([]),[N,j]=(0,a.useState)(!0),[w,C]=(0,a.useState)(!1),[Z,E]=(0,a.useState)(null),[S,M]=(0,a.useState)(""),I=(0,a.useCallback)(async()=>{if(!t||!e){j(!1);return}j(!0),M("");try{let t=await fetch("/api/bookings/list?userId=".concat(e.id));if(!t.ok)throw Error("Failed to fetch bookings");let r=(await t.json()).bookings||[],a=new Date;a.setHours(0,0,0,0);let l=r.filter(e=>{let t=new Date(e.check_in),r=new Date(e.check_out),l=e.status;switch(n){case"upcoming":return t>a&&"CANCELLED"!==l;case"current":return t<=a&&r>=a&&"CANCELLED"!==l;case"past":return r<a&&"CANCELLED"!==l;case"cancelled":return"CANCELLED"===l;default:return!0}});v(l)}catch(e){console.error("Error fetching bookings:",e),M("Failed to load bookings. Please try again.")}finally{j(!1)}},[n,t,e]);(0,a.useEffect)(()=>{I()},[I]);let L=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),D=e=>{let t=y[e]||y.PENDING;return(0,r.jsx)("span",{className:(0,p.cn)("px-3 py-1 rounded-full text-xs font-medium",t.bgColor,t.color),children:t.label})},_=e=>{E(e),C(!0)},z=async()=>{if(Z)try{if(!(await fetch("/api/bookings/".concat(Z.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"CANCELLED"})})).ok)throw Error("Failed to cancel booking");I(),C(!1),E(null)}catch(e){console.error("Error cancelling booking:",e),alert("Failed to cancel booking. Please try again.")}},P={upcoming:{icon:o.Z,title:"No upcoming bookings",description:"You don't have any upcoming stays. Time to plan your next trip!",cta:{text:"Browse Properties",href:"/properties"}},current:{icon:u.Z,title:"No current stays",description:"You're not checked in anywhere right now.",cta:{text:"Browse Properties",href:"/properties"}},past:{icon:d.Z,title:"No past bookings",description:"You haven't completed any stays yet.",cta:null},cancelled:{icon:h.Z,title:"No cancelled bookings",description:"You don't have any cancelled reservations.",cta:null}};return t?(0,r.jsxs)("main",{className:"min-h-screen bg-neutral-50 pt-20",children:[(0,r.jsx)("div",{className:"pt-4 pb-12",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 max-w-6xl",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-neutral-900",children:"My Bookings"}),(0,r.jsx)("p",{className:"text-neutral-600 mt-2",children:"Manage your reservations and view your stay history"})]}),(0,r.jsx)("div",{className:"border-b border-neutral-200 mb-8",children:(0,r.jsx)("div",{className:"flex gap-1",children:g.map(e=>(0,r.jsxs)("button",{onClick:()=>b(e.id),className:(0,p.cn)("px-6 py-4 font-medium text-sm transition-colors relative",n===e.id?"text-accent":"text-neutral-600 hover:text-neutral-900"),children:[e.label,n===e.id&&(0,r.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-accent"})]},e.id))})}),S&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg mb-6",children:S}),N?(0,r.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,r.jsx)(m.Z,{className:"animate-spin mr-2 text-accent",size:24}),(0,r.jsx)("span",{className:"text-neutral-600",children:"Loading your bookings..."})]}):0===k.length?(0,r.jsxs)("div",{className:"bg-white rounded-xl p-12 text-center border border-neutral-200",children:[a.createElement(P[n].icon,{size:48,className:"text-neutral-300 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-neutral-900 mb-2",children:P[n].title}),(0,r.jsx)("p",{className:"text-neutral-500 mb-6 max-w-md mx-auto",children:P[n].description}),P[n].cta&&(0,r.jsx)(l.default,{href:P[n].cta.href,children:(0,r.jsxs)(s.default,{children:[P[n].cta.text,(0,r.jsx)(f.Z,{size:18,className:"ml-2"})]})})]}):(0,r.jsx)("div",{className:"space-y-4",children:k.map(e=>(0,r.jsx)("div",{className:"bg-white rounded-xl border border-neutral-200 overflow-hidden hover:shadow-md transition-shadow",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,r.jsx)("div",{className:"relative w-full md:w-64 h-48 md:h-auto shrink-0 bg-neutral-100 flex items-center justify-center",children:(0,r.jsx)(u.Z,{className:"text-neutral-300",size:48})}),(0,r.jsx)("div",{className:"flex-1 p-6",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsxs)("span",{className:"text-xs text-neutral-500",children:["Booking #",e.booking_number]}),D(e.status)]}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-neutral-900",children:e.property_title}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4",children:[(0,r.jsxs)("div",{className:"p-3 bg-neutral-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-neutral-500 mb-1",children:"Check-in"}),(0,r.jsx)("p",{className:"font-medium text-neutral-900",children:L(e.check_in)})]}),(0,r.jsxs)("div",{className:"p-3 bg-neutral-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-neutral-500 mb-1",children:"Check-out"}),(0,r.jsx)("p",{className:"font-medium text-neutral-900",children:L(e.check_out)})]}),(0,r.jsxs)("div",{className:"p-3 bg-neutral-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-neutral-500 mb-1",children:"Nights"}),(0,r.jsx)("p",{className:"font-medium text-neutral-900",children:e.nights})]}),(0,r.jsxs)("div",{className:"p-3 bg-neutral-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-xs text-neutral-500 mb-1",children:"Guests"}),(0,r.jsx)("p",{className:"font-medium text-neutral-900",children:e.guests})]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold text-neutral-900",children:["$",e.total_price.toLocaleString()]}),(0,r.jsx)("p",{className:"text-sm text-neutral-500",children:e.currency}),(0,r.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,r.jsx)(l.default,{href:"/dashboard/bookings/".concat(e.id),children:(0,r.jsxs)(s.default,{variant:"outline",size:"sm",fullWidth:!0,children:["View Details",(0,r.jsx)(x.Z,{size:14,className:"ml-1"})]})}),("PENDING"===e.status||"CONFIRMED"===e.status)&&"upcoming"===n&&(0,r.jsx)(s.default,{variant:"ghost",size:"sm",fullWidth:!0,onClick:()=>_(e),children:"Cancel"})]})]})]})})]})},e.id))})]})}),(0,r.jsx)(i.u_,{isOpen:w,onClose:()=>{C(!1),E(null)},title:"Cancel Booking",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("p",{className:"text-neutral-600",children:["Are you sure you want to cancel booking ",(0,r.jsxs)("span",{className:"font-medium",children:["#",null==Z?void 0:Z.booking_number]}),"?"]}),(0,r.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"font-medium text-amber-800 mb-2",children:"⚠️ Please note:"}),(0,r.jsxs)("ul",{className:"text-sm text-amber-700 space-y-1",children:[(0,r.jsx)("li",{children:"• This action cannot be undone"}),(0,r.jsx)("li",{children:"• Refunds will be processed within 3-5 business days"}),(0,r.jsx)("li",{children:"• Cancellation fees may apply"})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,r.jsx)(s.default,{variant:"ghost",onClick:()=>{C(!1),E(null)},children:"Keep Booking"}),(0,r.jsx)(s.default,{variant:"danger",onClick:z,children:"Cancel Booking"})]})]})})]}):(0,r.jsx)("main",{className:"min-h-screen bg-neutral-50 pt-20",children:(0,r.jsx)("div",{className:"pt-4 pb-12",children:(0,r.jsx)("div",{className:"container mx-auto px-4 max-w-6xl",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl p-12 text-center border border-neutral-200",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-neutral-900 mb-4",children:"My Bookings"}),(0,r.jsx)("p",{className:"text-neutral-600 mb-6",children:"Please log in to view your bookings"}),(0,r.jsx)(l.default,{href:"/login",children:(0,r.jsx)(s.default,{children:"Log In"})})]})})})})}},1427:function(e,t,n){"use strict";n.d(t,{Qm:function(){return r.Qm},aC:function(){return r.aC},hx:function(){return r.hx}});var r=n(1579)},1579:function(e,t,n){"use strict";n.d(t,{Qm:function(){return m},UserProvider:function(){return u},aC:function(){return d},aF:function(){return d},hx:function(){return h}});var r=n(7437),a=n(2265),l=n(605);let s={language:"zh",currency:"CAD",notifications:{email:!0,sms:!0,marketing:!1}},i="stayneos_auth_token",c="stayneos_user_data",o=(0,a.createContext)(void 0);function u(e){let{children:t}=e,{data:n,status:u}=(0,l.useSession)(),[d,h]=(0,a.useState)(null),[m,f]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem(c),t=localStorage.getItem(i);if(e&&t){let t=JSON.parse(e);h(t)}}catch(e){console.error("Error loading user from storage:",e),localStorage.removeItem(c),localStorage.removeItem(i)}finally{f(!1)}})()},[]),(0,a.useEffect)(()=>{let e=e=>{if(e.key===c){if(e.newValue)try{let t=JSON.parse(e.newValue);h(t)}catch(e){h(null)}else h(null)}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),(0,a.useEffect)(()=>{if("authenticated"===u&&(null==n?void 0:n.user)){let e=n.user.name||"",t=e.split(" "),r=t[0]||"",a=t.slice(1).join(" ")||"",l={id:n.user.id,firstName:r,lastName:a,name:e,email:n.user.email||"",image:n.user.image||void 0,avatar:n.user.image||void 0,phone:"",dateOfBirth:"",nationality:"",preferences:s,memberSince:new Date().toISOString().split("T")[0],memberLevel:"普通会员",role:n.user.role||"USER"};h(l),localStorage.setItem(c,JSON.stringify(l))}else"unauthenticated"!==u||localStorage.getItem(i)||h(null)},[n,u]);let x=(0,a.useCallback)(async e=>{f(!0);try{h(t=>{if(!t)return null;let n={...t,...e};return localStorage.setItem(c,JSON.stringify(n)),n}),await new Promise(e=>setTimeout(e,500))}finally{f(!1)}},[]),p=(0,a.useCallback)(async e=>{f(!0);try{h(t=>{if(!t)return null;let n={...t,preferences:{...t.preferences,...e,notifications:{...t.preferences.notifications,...e.notifications}}};return localStorage.setItem(c,JSON.stringify(n)),e.language&&(window.dispatchEvent(new CustomEvent("localeChange")),localStorage.setItem("preferred-locale",e.language)),n}),await new Promise(e=>setTimeout(e,300))}finally{f(!1)}},[]),g=(0,a.useCallback)(async e=>{f(!0);try{h(t=>{if(!t)return null;let n={...t,avatar:e,image:e};return localStorage.setItem(c,JSON.stringify(n)),n}),await new Promise(e=>setTimeout(e,500))}finally{f(!1)}},[]),y=(0,a.useCallback)(async()=>{localStorage.removeItem(i),localStorage.removeItem(c),h(null),window.dispatchEvent(new CustomEvent("localStorageChange")),await (0,l.signOut)({callbackUrl:"/"})},[]),b=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem(i);if(!e)return;let t=await fetch("/api/auth/session",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();h(t=>{if(!t)return null;let n={...t,...e};return localStorage.setItem(c,JSON.stringify(n)),n})}else 401===t.status&&await y()}catch(e){console.error("Error refreshing user:",e)}},[y]);return(0,a.useEffect)(()=>{if(!localStorage.getItem(i))return;let e=setInterval(()=>{b()},3e5);return()=>clearInterval(e)},[b]),(0,r.jsx)(o.Provider,{value:{user:d,isLoading:m||"loading"===u,isAuthenticated:!!d,updateProfile:x,updatePreferences:p,updateAvatar:g,logout:y,refreshUser:b},children:t})}function d(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}function h(e){if(!e)return"#3B82F6";let t=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"],n=0;for(let t=0;t<e.length;t++)n=e.charCodeAt(t)+((n<<5)-n);return t[Math.abs(n)%t.length]}function m(e){if(!e)return"?";let t=e.trim().split(/\s+/);return 1===t.length?t[0].slice(0,2).toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}}},function(e){e.O(0,[7648,863,605,5883,8276,2971,2117,1744],function(){return e(e.s=9068)}),_N_E=e.O()}]);