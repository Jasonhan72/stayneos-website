(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4178],{6068:function(e,t,a){Promise.resolve().then(a.bind(a,2e3))},2e3:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var l=a(7437),n=a(2265),r=a(7648),s=a(1579),i=a(3145),o=a(1817),c=a(3581),d=a(2489),u=a(3448);function m(e){let{size:t="lg",className:a}=e,{user:r,updateAvatar:m}=(0,s.aF)(),[x,h]=(0,n.useState)(!1),[f,g]=(0,n.useState)((null==r?void 0:r.avatar)||null),p=(0,n.useRef)(null),b={sm:14,md:20,lg:24,xl:32},v=async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;if(!a.type.startsWith("image/")){alert("Please select an image file");return}if(a.size>5242880){alert("File size must be less than 5MB");return}let l=new FileReader;l.onloadend=()=>{g(l.result)},l.readAsDataURL(a),h(!0);try{await new Promise(e=>setTimeout(e,1e3)),await m(l.result)}catch(e){console.error("Failed to upload avatar:",e),alert("Failed to upload avatar. Please try again."),g((null==r?void 0:r.avatar)||null)}finally{h(!1)}},N=async()=>{h(!0);try{await m(""),g(null)}finally{h(!1)}};return(0,l.jsxs)("div",{className:(0,u.cn)("relative",a),children:[(0,l.jsxs)("div",{className:(0,u.cn)("relative rounded-full overflow-hidden flex items-center justify-center",{sm:"w-10 h-10 text-sm",md:"w-16 h-16 text-lg",lg:"w-24 h-24 text-xl",xl:"w-32 h-32 text-2xl"}[t],f?"":"bg-accent text-primary font-semibold",a),children:[f?(0,l.jsx)(i.default,{src:f,alt:r?"".concat(r.firstName," ").concat(r.lastName):"Profile",fill:!0,className:"object-cover"}):r?((e,t)=>{let a=(null==e?void 0:e.charAt(0))||"",l=(null==t?void 0:t.charAt(0))||"";return"".concat(a).concat(l).toUpperCase()||"?"})(r.firstName,r.lastName):"?",(0,l.jsx)("button",{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},disabled:x,className:(0,u.cn)("absolute inset-0 flex items-center justify-center bg-black/50 transition-opacity","opacity-0 hover:opacity-100 focus:opacity-100","text-white cursor-pointer"),children:x?(0,l.jsx)(o.Z,{size:b[t],className:"animate-spin"}):(0,l.jsx)(c.Z,{size:b[t]})})]}),f&&(0,l.jsx)("button",{onClick:N,disabled:x,className:(0,u.cn)("absolute -top-1 -right-1 p-1.5 rounded-full bg-red-500 text-white shadow-md","hover:bg-red-600 transition-colors","disabled:opacity-50 disabled:cursor-not-allowed"),title:"Remove photo",children:(0,l.jsx)(d.Z,{size:14})}),(0,l.jsx)("input",{ref:p,type:"file",accept:"image/*",onChange:v,className:"hidden",disabled:x})]})}var x=a(6334),h=a(6741),f=a(2451),g=a(8906),p=a(401),b=a(2369),v=a(9345),N=a(9322),j=a(3041),y=a(1047),C=a(6211);let w=["Canada","United States","China","United Kingdom","France","Germany","Australia","Japan","Singapore","Other"];function S(){let{user:e,updateProfile:t,isLoading:a}=(0,s.aF)(),[i,o]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!1),[S,k]=(0,n.useState)({firstName:"",lastName:"",email:"",phone:"",dateOfBirth:"",nationality:"",emergencyContactName:"",emergencyContactPhone:"",emergencyContactRelationship:""});(0,n.useEffect)(()=>{if(e){var t,a,l;k({firstName:e.firstName||"",lastName:e.lastName||"",email:e.email||"",phone:e.phone||"",dateOfBirth:e.dateOfBirth||"",nationality:e.nationality||"",emergencyContactName:(null===(t=e.emergencyContact)||void 0===t?void 0:t.name)||"",emergencyContactPhone:(null===(a=e.emergencyContact)||void 0===a?void 0:a.phone)||"",emergencyContactRelationship:(null===(l=e.emergencyContact)||void 0===l?void 0:l.relationship)||""})}},[e]);let P=(e,t)=>{k(a=>({...a,[e]:t}))},E=async()=>{await t({firstName:S.firstName,lastName:S.lastName,phone:S.phone,dateOfBirth:S.dateOfBirth,nationality:S.nationality,emergencyContact:{name:S.emergencyContactName,phone:S.emergencyContactPhone,relationship:S.emergencyContactRelationship}}),o(!1),d(!0),setTimeout(()=>d(!1),3e3)};return e?(0,l.jsx)("main",{className:"min-h-screen bg-neutral-50 pt-24 pb-12",children:(0,l.jsxs)(h.W2,{children:[(0,l.jsxs)(r.default,{href:"/dashboard",className:"inline-flex items-center gap-2 text-neutral-600 hover:text-neutral-900 mb-6",children:[(0,l.jsx)(f.Z,{size:20}),(0,l.jsx)("span",{children:"Back to Dashboard"})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-neutral-900",children:"Personal details"}),(0,l.jsx)("p",{className:"text-neutral-600 mt-2",children:"Manage your personal information and contact details"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsxs)("div",{className:"lg:col-span-1",children:[(0,l.jsxs)(h.Zb,{className:"p-6 text-center",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-neutral-900 mb-6",children:"Profile Photo"}),(0,l.jsx)("div",{className:"flex justify-center mb-4",children:(0,l.jsx)(m,{size:"xl"})}),(0,l.jsx)("p",{className:"text-sm text-neutral-500",children:"Click on the photo to upload a new one"}),(0,l.jsx)("p",{className:"text-xs text-neutral-400 mt-2",children:"JPG, PNG or GIF. Max 5MB."})]}),(0,l.jsxs)(h.Zb,{className:"mt-6 p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center",children:(0,l.jsx)(g.Z,{className:"text-accent",size:20})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-neutral-500",children:"Member since"}),(0,l.jsx)("p",{className:"font-medium text-neutral-900",children:e.memberSince})]})]}),(0,l.jsxs)("div",{className:"pt-4 border-t border-neutral-200",children:[(0,l.jsx)("p",{className:"text-sm text-neutral-500",children:"Member level"}),(0,l.jsx)("p",{className:"font-semibold text-accent",children:e.memberLevel})]})]})]}),(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsxs)(h.Zb,{children:[(0,l.jsx)("div",{className:"p-6 border-b border-neutral-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-neutral-900",children:"Basic Information"}),(0,l.jsx)("p",{className:"text-sm text-neutral-500 mt-1",children:"Update your personal details"})]}),i?(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(x.default,{variant:"ghost",onClick:()=>{var t,a,l;k({firstName:(null==e?void 0:e.firstName)||"",lastName:(null==e?void 0:e.lastName)||"",email:(null==e?void 0:e.email)||"",phone:(null==e?void 0:e.phone)||"",dateOfBirth:(null==e?void 0:e.dateOfBirth)||"",nationality:(null==e?void 0:e.nationality)||"",emergencyContactName:(null==e?void 0:null===(t=e.emergencyContact)||void 0===t?void 0:t.name)||"",emergencyContactPhone:(null==e?void 0:null===(a=e.emergencyContact)||void 0===a?void 0:a.phone)||"",emergencyContactRelationship:(null==e?void 0:null===(l=e.emergencyContact)||void 0===l?void 0:l.relationship)||""}),o(!1)},children:"Cancel"}),(0,l.jsx)(x.default,{onClick:E,isLoading:a,children:a?"Saving...":(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p.Z,{size:18})," Save"]})})]}):(0,l.jsx)(x.default,{variant:"outline",onClick:()=>o(!0),children:"Edit"})]})}),c&&(0,l.jsxs)("div",{className:"mx-6 mt-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-2 text-green-700",children:[(0,l.jsx)(p.Z,{size:18}),(0,l.jsx)("span",{children:"Your profile has been updated successfully!"})]}),(0,l.jsxs)("div",{className:"p-6 space-y-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"First Name"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(b.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),(0,l.jsx)("input",{type:"text",value:S.firstName,onChange:e=>P("firstName",e.target.value),disabled:!i,className:(0,u.cn)("w-full pl-10 pr-4 py-3 border rounded-lg transition-colors",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500")})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Last Name"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(b.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),(0,l.jsx)("input",{type:"text",value:S.lastName,onChange:e=>P("lastName",e.target.value),disabled:!i,className:(0,u.cn)("w-full pl-10 pr-4 py-3 border rounded-lg transition-colors",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500")})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Email Address"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(v.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),(0,l.jsx)("input",{type:"email",value:S.email,disabled:!0,className:"w-full pl-10 pr-4 py-3 border border-neutral-200 bg-neutral-50 rounded-lg text-neutral-500"})]}),(0,l.jsxs)("p",{className:"text-xs text-neutral-500 mt-1 flex items-center gap-1",children:[(0,l.jsx)(N.Z,{size:12}),"Email cannot be changed. Contact support if needed."]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Phone Number"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(j.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),(0,l.jsx)("input",{type:"tel",value:S.phone,onChange:e=>P("phone",e.target.value),disabled:!i,placeholder:"+1 (XXX) XXX-XXXX",className:(0,u.cn)("w-full pl-10 pr-4 py-3 border rounded-lg transition-colors",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500")})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Date of Birth"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(y.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),(0,l.jsx)("input",{type:"date",value:S.dateOfBirth,onChange:e=>P("dateOfBirth",e.target.value),disabled:!i,className:(0,u.cn)("w-full pl-10 pr-4 py-3 border rounded-lg transition-colors",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500")})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Nationality"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(C.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),(0,l.jsxs)("select",{value:S.nationality,onChange:e=>P("nationality",e.target.value),disabled:!i,className:(0,u.cn)("w-full pl-10 pr-4 py-3 border rounded-lg transition-colors appearance-none bg-white",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500"),children:[(0,l.jsx)("option",{value:"",children:"Select nationality"}),w.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]})]})]})]}),(0,l.jsx)("div",{className:"border-t border-neutral-200",children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-neutral-900 mb-1",children:"Emergency Contact"}),(0,l.jsx)("p",{className:"text-sm text-neutral-500 mb-6",children:"Someone we can contact in case of emergency"}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Contact Name"}),(0,l.jsx)("input",{type:"text",value:S.emergencyContactName,onChange:e=>P("emergencyContactName",e.target.value),disabled:!i,placeholder:"Full name",className:(0,u.cn)("w-full px-4 py-3 border rounded-lg transition-colors",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500")})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Relationship"}),(0,l.jsx)("input",{type:"text",value:S.emergencyContactRelationship,onChange:e=>P("emergencyContactRelationship",e.target.value),disabled:!i,placeholder:"e.g., Spouse, Parent, Friend",className:(0,u.cn)("w-full px-4 py-3 border rounded-lg transition-colors",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500")})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Contact Phone"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(j.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:18}),(0,l.jsx)("input",{type:"tel",value:S.emergencyContactPhone,onChange:e=>P("emergencyContactPhone",e.target.value),disabled:!i,placeholder:"+1 (XXX) XXX-XXXX",className:(0,u.cn)("w-full pl-10 pr-4 py-3 border rounded-lg transition-colors",i?"border-neutral-300 focus:border-accent focus:ring-2 focus:ring-accent/20":"border-neutral-200 bg-neutral-50 text-neutral-500")})]})]})]})]})})]})})]})]})}):(0,l.jsx)("div",{className:"min-h-screen bg-neutral-50 pt-24 pb-12",children:(0,l.jsx)(h.W2,{children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-neutral-600",children:"Please log in to view your profile."}),(0,l.jsx)(r.default,{href:"/login",children:(0,l.jsx)(x.default,{className:"mt-4",children:"Log in"})})]})})})}},1579:function(e,t,a){"use strict";a.d(t,{Qm:function(){return x},UserProvider:function(){return d},aC:function(){return u},aF:function(){return u},hx:function(){return m}});var l=a(7437),n=a(2265),r=a(605);let s={language:"zh",currency:"CAD",notifications:{email:!0,sms:!0,marketing:!1}},i="stayneos_auth_token",o="stayneos_user_data",c=(0,n.createContext)(void 0);function d(e){let{children:t}=e,{data:a,status:d}=(0,r.useSession)(),[u,m]=(0,n.useState)(null),[x,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(()=>{try{let e=localStorage.getItem(o),t=localStorage.getItem(i);if(e&&t){let t=JSON.parse(e);m(t)}}catch(e){console.error("Error loading user from storage:",e),localStorage.removeItem(o),localStorage.removeItem(i)}finally{h(!1)}})()},[]),(0,n.useEffect)(()=>{let e=e=>{if(e.key===o){if(e.newValue)try{let t=JSON.parse(e.newValue);m(t)}catch(e){m(null)}else m(null)}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),(0,n.useEffect)(()=>{if("authenticated"===d&&(null==a?void 0:a.user)){let e=a.user.name||"",t=e.split(" "),l=t[0]||"",n=t.slice(1).join(" ")||"",r={id:a.user.id,firstName:l,lastName:n,name:e,email:a.user.email||"",image:a.user.image||void 0,avatar:a.user.image||void 0,phone:"",dateOfBirth:"",nationality:"",preferences:s,memberSince:new Date().toISOString().split("T")[0],memberLevel:"普通会员",role:a.user.role||"USER"};m(r),localStorage.setItem(o,JSON.stringify(r))}else"unauthenticated"!==d||localStorage.getItem(i)||m(null)},[a,d]);let f=(0,n.useCallback)(async e=>{h(!0);try{m(t=>{if(!t)return null;let a={...t,...e};return localStorage.setItem(o,JSON.stringify(a)),a}),await new Promise(e=>setTimeout(e,500))}finally{h(!1)}},[]),g=(0,n.useCallback)(async e=>{h(!0);try{m(t=>{if(!t)return null;let a={...t,preferences:{...t.preferences,...e,notifications:{...t.preferences.notifications,...e.notifications}}};return localStorage.setItem(o,JSON.stringify(a)),e.language&&(window.dispatchEvent(new CustomEvent("localeChange")),localStorage.setItem("preferred-locale",e.language)),a}),await new Promise(e=>setTimeout(e,300))}finally{h(!1)}},[]),p=(0,n.useCallback)(async e=>{h(!0);try{m(t=>{if(!t)return null;let a={...t,avatar:e,image:e};return localStorage.setItem(o,JSON.stringify(a)),a}),await new Promise(e=>setTimeout(e,500))}finally{h(!1)}},[]),b=(0,n.useCallback)(async()=>{localStorage.removeItem(i),localStorage.removeItem(o),m(null),window.dispatchEvent(new CustomEvent("localStorageChange")),await (0,r.signOut)({callbackUrl:"/"})},[]),v=(0,n.useCallback)(async()=>{try{let e=localStorage.getItem(i);if(!e)return;let t=await fetch("/api/auth/session",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();m(t=>{if(!t)return null;let a={...t,...e};return localStorage.setItem(o,JSON.stringify(a)),a})}else 401===t.status&&await b()}catch(e){console.error("Error refreshing user:",e)}},[b]);return(0,n.useEffect)(()=>{if(!localStorage.getItem(i))return;let e=setInterval(()=>{v()},3e5);return()=>clearInterval(e)},[v]),(0,l.jsx)(c.Provider,{value:{user:u,isLoading:x||"loading"===d,isAuthenticated:!!u,updateProfile:f,updatePreferences:g,updateAvatar:p,logout:b,refreshUser:v},children:t})}function u(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}function m(e){if(!e)return"#3B82F6";let t=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"],a=0;for(let t=0;t<e.length;t++)a=e.charCodeAt(t)+((a<<5)-a);return t[Math.abs(a)%t.length]}function x(e){if(!e)return"?";let t=e.trim().split(/\s+/);return 1===t.length?t[0].slice(0,2).toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}}},function(e){e.O(0,[7648,863,5878,605,6393,5883,8276,2971,2117,1744],function(){return e(e.s=6068)}),_N_E=e.O()}]);