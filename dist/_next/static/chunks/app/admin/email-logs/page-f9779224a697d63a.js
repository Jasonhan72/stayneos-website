(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9840],{2432:function(e,t,r){Promise.resolve().then(r.bind(r,6859))},6859:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var s=r(7437),a=r(2265),n=r(1427);function l(){let{user:e,isAuthenticated:t}=(0,n.aC)(),[r,l]=(0,a.useState)([]),[i,c]=(0,a.useState)(null),[o,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(null),x=(null==e?void 0:e.role)==="ADMIN"||(null==e?void 0:e.email)==="hello@stayneos.com";(0,a.useEffect)(()=>{t&&(h(),f())},[t]);let h=async()=>{try{let e=await fetch("/api/admin/email-logs");if(e.ok){let t=await e.json();l(t.logs||[])}}catch(e){console.error("Error fetching logs:",e)}},f=async()=>{try{let e=await fetch("/api/test/email");if(e.ok){let t=await e.json();c(t)}}catch(e){console.error("Error fetching config:",e)}},p=async()=>{if(o){m(null);try{let e=await fetch("/api/test/email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:o})}),t=await e.json();m(t)}catch(e){m({success:!1,error:e instanceof Error?e.message:"Unknown error"})}}};return t?x?(0,s.jsx)("div",{className:"min-h-screen bg-neutral-50 pt-24 pb-12",children:(0,s.jsxs)("div",{className:"container mx-auto px-4 max-w-6xl",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-neutral-900 mb-8",children:"邮件系统管理"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 mb-8 border border-neutral-200",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"邮件配置状态"}),i?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-neutral-600",children:"Resend API Key:"}),(0,s.jsx)("span",{className:i.resendApiKeyConfigured?"text-green-600":"text-red-600",children:i.resendApiKeyConfigured?"✓ 已配置":"✗ 未配置"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-neutral-600",children:"发件邮箱:"}),(0,s.jsx)("span",{children:i.resendFromEmail})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-neutral-600",children:"检查时间:"}),(0,s.jsx)("span",{children:new Date(i.timestamp).toLocaleString("zh-CN")})]})]}):(0,s.jsx)("p",{className:"text-neutral-500",children:"加载中..."})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 mb-8 border border-neutral-200",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"发送测试邮件"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("input",{type:"email",value:o,onChange:e=>d(e.target.value),placeholder:"输入测试邮箱地址",className:"flex-1 px-4 py-2 border border-neutral-300 rounded-lg"}),(0,s.jsx)("button",{onClick:p,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-700",children:"发送测试"})]}),u&&(0,s.jsx)("div",{className:"mt-4 p-4 rounded-lg ".concat(u.success?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:u.success?(0,s.jsxs)("p",{children:["✓ ",u.message]}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:["✗ ",u.error]}),u.details&&(0,s.jsx)("p",{className:"text-sm mt-1",children:u.details})]})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-neutral-200",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"邮件发送日志"}),0===r.length?(0,s.jsx)("p",{className:"text-neutral-500",children:"暂无邮件记录"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-neutral-200",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"时间"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"收件人"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"类型"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"状态"}),(0,s.jsx)("th",{className:"text-left py-3 px-4",children:"主题"})]})}),(0,s.jsx)("tbody",{children:r.map(e=>(0,s.jsxs)("tr",{className:"border-b border-neutral-100",children:[(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:new Date(e.sent_at).toLocaleString("zh-CN")}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:e.recipient}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:e.recipient_type}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded ".concat("SENT"===e.status?"bg-green-100 text-green-700":"FAILED"===e.status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:e.status})}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm truncate max-w-xs",children:e.subject})]},e.id))})]})})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-neutral-50 pt-24 pb-12",children:(0,s.jsx)("div",{className:"container mx-auto px-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl p-8 text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"无权限访问"}),(0,s.jsx)("p",{className:"text-neutral-600",children:"只有管理员可以访问此页面"})]})})}):(0,s.jsx)("div",{className:"min-h-screen bg-neutral-50 pt-24 pb-12",children:(0,s.jsx)("div",{className:"container mx-auto px-4",children:(0,s.jsx)("div",{className:"bg-white rounded-xl p-8 text-center",children:(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"请先登录"})})})})}},1427:function(e,t,r){"use strict";r.d(t,{Qm:function(){return s.Qm},aC:function(){return s.aC},hx:function(){return s.hx}});var s=r(1579)},1579:function(e,t,r){"use strict";r.d(t,{Qm:function(){return x},UserProvider:function(){return d},aC:function(){return u},aF:function(){return u},hx:function(){return m}});var s=r(7437),a=r(2265),n=r(605);let l={language:"zh",currency:"CAD",notifications:{email:!0,sms:!0,marketing:!1}},i="stayneos_auth_token",c="stayneos_user_data",o=(0,a.createContext)(void 0);function d(e){let{children:t}=e,{data:r,status:d}=(0,n.useSession)(),[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem(c),t=localStorage.getItem(i);if(e&&t){let t=JSON.parse(e);m(t)}}catch(e){console.error("Error loading user from storage:",e),localStorage.removeItem(c),localStorage.removeItem(i)}finally{h(!1)}})()},[]),(0,a.useEffect)(()=>{let e=e=>{if(e.key===c){if(e.newValue)try{let t=JSON.parse(e.newValue);m(t)}catch(e){m(null)}else m(null)}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),(0,a.useEffect)(()=>{if("authenticated"===d&&(null==r?void 0:r.user)){let e=r.user.name||"",t=e.split(" "),s=t[0]||"",a=t.slice(1).join(" ")||"",n={id:r.user.id,firstName:s,lastName:a,name:e,email:r.user.email||"",image:r.user.image||void 0,avatar:r.user.image||void 0,phone:"",dateOfBirth:"",nationality:"",preferences:l,memberSince:new Date().toISOString().split("T")[0],memberLevel:"普通会员",role:r.user.role||"USER"};m(n),localStorage.setItem(c,JSON.stringify(n))}else"unauthenticated"!==d||localStorage.getItem(i)||m(null)},[r,d]);let f=(0,a.useCallback)(async e=>{h(!0);try{m(t=>{if(!t)return null;let r={...t,...e};return localStorage.setItem(c,JSON.stringify(r)),r}),await new Promise(e=>setTimeout(e,500))}finally{h(!1)}},[]),p=(0,a.useCallback)(async e=>{h(!0);try{m(t=>{if(!t)return null;let r={...t,preferences:{...t.preferences,...e,notifications:{...t.preferences.notifications,...e.notifications}}};return localStorage.setItem(c,JSON.stringify(r)),e.language&&(window.dispatchEvent(new CustomEvent("localeChange")),localStorage.setItem("preferred-locale",e.language)),r}),await new Promise(e=>setTimeout(e,300))}finally{h(!1)}},[]),g=(0,a.useCallback)(async e=>{h(!0);try{m(t=>{if(!t)return null;let r={...t,avatar:e,image:e};return localStorage.setItem(c,JSON.stringify(r)),r}),await new Promise(e=>setTimeout(e,500))}finally{h(!1)}},[]),b=(0,a.useCallback)(async()=>{localStorage.removeItem(i),localStorage.removeItem(c),m(null),window.dispatchEvent(new CustomEvent("localStorageChange")),await (0,n.signOut)({callbackUrl:"/"})},[]),j=(0,a.useCallback)(async()=>{try{let e=localStorage.getItem(i);if(!e)return;let t=await fetch("/api/auth/session",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();m(t=>{if(!t)return null;let r={...t,...e};return localStorage.setItem(c,JSON.stringify(r)),r})}else 401===t.status&&await b()}catch(e){console.error("Error refreshing user:",e)}},[b]);return(0,a.useEffect)(()=>{if(!localStorage.getItem(i))return;let e=setInterval(()=>{j()},3e5);return()=>clearInterval(e)},[j]),(0,s.jsx)(o.Provider,{value:{user:u,isLoading:x||"loading"===d,isAuthenticated:!!u,updateProfile:f,updatePreferences:p,updateAvatar:g,logout:b,refreshUser:j},children:t})}function u(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}function m(e){if(!e)return"#3B82F6";let t=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16","#F97316","#6366F1"],r=0;for(let t=0;t<e.length;t++)r=e.charCodeAt(t)+((r<<5)-r);return t[Math.abs(r)%t.length]}function x(e){if(!e)return"?";let t=e.trim().split(/\s+/);return 1===t.length?t[0].slice(0,2).toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}}},function(e){e.O(0,[605,2971,2117,1744],function(){return e(e.s=2432)}),_N_E=e.O()}]);